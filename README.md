# 文件操作工具

这是一个为 AstrBot 设计的高级文件管理插件。它赋予大语言模型（LLM）直接操作机器人服务器工作区文件的能力，支持读取、写入、生成代码以及制作 Office 文档。

## 🌟 核心特性

- **智能文件生成**：支持 Python, JS, HTML, Markdown 等多种编程和文档格式的自动生成与发送。
- **Office 增强**：原生支持生成 Word (.docx), Excel (.xlsx) 和 PowerPoint (.pptx) 文件。
- **精细权限控制**：
    - **管理员模式**：可限制仅管理员可用。
    - **白名单机制**：支持指定特定用户调用。
    - **群聊安全逻辑**：支持“必须 @ 或引用机器人”才暴露工具，防止群聊误触发及 Token 浪费。

## 🛠️ 安装与配置

### 依赖要求
若需使用 Office 生成功能，请确保安装以下 Python 库：
```bash
pip install python-docx openpyxl python-pptx
```

### 配置项说明
在 AstrBot 管理面板中，你可以配置以下内容：
- **群聊触发**：是否要求必须 @ 或引用机器人。
- **回复设置**：发送文件时是否引用用户的原始消息。
- **权限设置**：配置管理员开关或用户白名单。
- **Office 开关**：全局启用或禁用 Office 相关功能。

## 📖 提供的工具 (LLM Tools)

1. `list_files`: 查看当前工作区的所有文件详情。
2. `read_file`: 读取文本类文件的内容。
3. `write_file`: 创建、更新或生成各种格式的文件（含 Office）。
4. `delete_file`: 永久删除指定文件.
5. `convert_file`: 转换文件格式（未实现）。

## 📝 开发日志

### [2025-12-22] 架构重构
- **全面转向工具化**：移除了旧版的 `file_analyzer` 意图识别层，改为通过 `@llm_tool` 暴露能力，显著降低了对话延迟和 Token 消耗。
- **动态注入机制**：实现了基于场景和权限的工具动态隐藏逻辑（`on_llm_request`），在非必要场景下不向模型暴露文件工具。
- **安全加固**：完善了群聊触发逻辑，增加了对“引用/回复机器人消息”的判定支持。

### [早期版本] 初始功能实现
- 支持基础的文本文件读写。
- 集成 `file_generator` 和 `office_generator` 底层引擎。
- 实现基础的 WebUI 配置支持。
